# 6.redis雪崩、穿透、击穿

1.雪崩:redis发生了故障并宕机，所有的数据请求全都落在了关系数据库上，导致数据库崩溃
2.穿透：黑客根据特点发送攻击，查询不可能存在的条件导致查询全都落在关系数据库上，导致关系数据库崩溃
3.击穿：某个key非常热点，访问非常频繁，当这个key在失效的瞬间，大量的请求就击穿了缓存，直接请求数据库，就像是在一道屏障上凿开了一个洞
4.雪崩解决方案：
 - 事前：Redis高可用，主从+哨兵，Redis cluster，避免全盘崩溃
 - 事中：本地ehcache缓存 + hystrix限流&降级,避免关系数据库被打死
 - 事后：Redis持久化，一旦重启，自动从磁盘上加载数据，快速恢复缓存数据
5.穿透解决方案：
 - 只要数据没查询到，set一个空值到redis中，比如 set -999 unknown,然后设置一个过期时间，这样下次再有相同的key的时候，在缓存失效之前，可以直接从缓存中取数据
6.缓存击穿解决方案：
 - 若缓存的数据基本不发生变更，可设置此热点数据为永不过期
 - 若缓存的数据更新不频繁，且缓存刷新的整个流程耗时较少的情况下，可以采用基于Redis、Zookeeper等分布式互斥锁，或者本地互斥锁以保证仅少量的请求能请求数据库并重新构建缓存，其余线程则在锁释放后能访问到新缓存
 - 若缓存的数据更新频繁或刷新的流程耗时过长，可以利用定时线程在缓存过期前主动重新构建缓存或者延后缓存的过期时间，以保证所有的请求能一直访问到对应的缓存
 