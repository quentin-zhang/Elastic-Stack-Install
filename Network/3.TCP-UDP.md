# TCP与UDP

## TCP与UDP的差别

UDP在传送数据之前不需要先建立连接，远地主机在收到UDP报文后，不需要给出任何确认

TCP提供面向连接的服务。在传送数据之前必须先建立连接，数据传送结束后要释放连接。TCP不提供广播或者多播服务。由于TCP要提供可靠的，面向连接的传输服务（之前三次握手，传递时有确认、窗口、重传、拥塞控制机制，在数据传完后，还会断开连接用来节约系统资源），增加了许多资源开销，如确认，流量控制、计时器以及连接管理等。使得协议数据的首部增大很多，还要占用许多处理机资源。TCP一般用于文件传输、发送和接收邮件、远程登录等场景

## TCP协议如何保证可靠传输

1.应用数据被分割成TCP认为最适合发送的数据块
2.TCP给发送的每一个包进行编号，接收方对数据包进行排序，把有序数据传送给应用层
3.校验和：TCP将保持它首部和数据的校验和。这是一个端到端的校验和，目的是检测数据在传输过程中的任何变化。如果收到段的检验和有差错，TCP将丢弃这个报文段和不确认收到此报文段
4.TCP的接收端会丢弃重复的数据
5.流量控制：TCP连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲区能接纳的数据。当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP使用的流量控制协议是可变大小的滑动窗口协议。
6.拥塞控制：当网络拥塞时，减少数据的发送
7.ARQ协议：也是为了实现可靠传输的，它的基本原理就是每发送完一个分钟就停止发送，等待对方确认。在收到确认后再发下一个分组。
8.超时重传：当TCP发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段，如果不能及时收到一个确认，将重发这个报文段

## ARQ协议

自动重传请求ARQ是OSI模型中数据链路层和传输层的错误纠正协议之一。它通过使用确认和超时这两个机制，在不可靠服务的基础上实现可靠的信息传输。如果发送方在发送一端时间之内没有收到确认帧，它通常会重新发送。ARQ包括停止等待ARQ协议和连续ARQ协议。

* 停止等待ARQ协议：为了实现可靠传输的，基本原理就是每发完一个分组就停止发送，等待对方确认（回复ACK）。如果过了一段时间（超时时间后），还是没有收到ACK确认，说明没有发送成功，需要重新发送，直到收到确认后再发送下一个分组；在停止等待协议中，若接收方收到重复分组，就丢弃该分组，但同时还要发送确认。
优点：简单
缺点：信道利用率低，等待时间长

* 连续ARQ协议：可提供信道利用率，发送方维持一个发送窗口，凡位于发送窗口内的分组可以连续发送出去，而不需要等待对方确认。接收方一般采用累计确认，对按序到达的最后一个分组发送确认，表明到这个分组为止的所有分组都已经正确收到了。
优点：信道利用率高，容易实现，及时确认丢失，也不必重传
缺点：不能向发送方反映出接收方已经正确收到的所有分组的信息。
