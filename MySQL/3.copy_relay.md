# 主从复制的高并发

1.主从复制原理：主库将变更写入binlog日志;从库通过IO现成将主库的binlog日志copy到自己本地，写入relay中继日志中。接着从库有一个SQL线程读取中继日志的内容，在本地执行一遍sql。
2.mysql两种机制：半同步复制与并行复制；半同步是至少有一个从库返回ack之后才会认为写操作完成了；并行复制是指从库开启多个线程，并行读取`relay log`中不同库的日志，然后并行重放不同库的日志
3.解决主从复制的高并发问题：

* 分库，将一个主库拆分为多个主库，每个主库的写并发会减少
* 打开mysql支持的并行复制,如果单库的qps达到2000/s就没有意义了
* 重写代码，如果想插入数据后立马查询到，有可能从库还没更新完，查询不到
* 如果确实需要先插入，立马查询到，可以设置这个查询**直连主库**，不过**不推荐**，这样的话读写分离就没有意义
  