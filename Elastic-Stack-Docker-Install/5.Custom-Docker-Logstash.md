# 5.自定义Logstash容器

（1）创建新文件夹

```
mkdir /usr/local/dockermake
mkdir /usr/local/dockermake/config
mkdir /usr/local/dockermake/pipeline
```


（2）新建logstash配置

```
    vim /usr/local/dockermake/config/logstash.yml
```

加入以下4行：

```
path.config: /usr/share/logstash/pipeline
xpack.monitoring.elasticsearch.url: http://1.2.3.4:9200
xpack.monitoring.elasticsearch.username: elastic
xpack.monitoring.elasticsearch.password: "changeme"
```

（3）新建管道配置

```
    vim /usr/local/dockermake/pipeline/logstash.conf
```

管道配置如下：

```
input {
  beats {
    port => 5044
  }
    stdin {
    id => "test"
  }
}
filter {
}
output {
    elasticsearch {
        hosts => ["1.2.3.4:9200"]
        manage_template => false
        index => "test-%{+YYYY-MM-dd}"
        user => "elastic"
        password => "changeme"
      }
    stdout {
            codec => rubydebug
    }

}
```

（4）新建Dockerfile文件

```
     vim /usr/local/dockermake/Dockerfile
```

添加Dockerfile的命令

```
FROM docker.elastic.co/logstash/logstash:5.5.3
RUN rm -f /usr/share/logstash/pipeline/logstash.conf
ADD pipeline/ /usr/share/logstash/pipeline/
ADD config/ /usr/share/logstash/config/
```

（5）建立Docker容器

```
cd /usr/local/dockermake
docker build -t my-logstash:5.5.3 .
```

（6）运行Docker

```
docker run --name logstash -it my-logstash:5.5.3
```