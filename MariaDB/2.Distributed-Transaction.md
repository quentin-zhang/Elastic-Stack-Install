# 2.分布式事务

AT TCC SAGA XA事务

## 1.AT模式

### 基于支持本地ACID事务的关系型数据库，Java应用，通过JDBC访问数据库
### 两阶段提交协议：(1)业务数据与回滚日志记录在同一个本地事务中提交，释放本地锁和连接资源
###                 (2)提交异步化（成功），回滚通过一阶段的回滚进行反向补偿（失败）
### 写隔离：一阶段事务提交前，必须拿到全局锁
### 读隔离：采用select for update来实现读已提交的隔离级别；执行时会申请全局锁，如果全局锁被其它事务持有，则回滚并重试

## 2.TCC模式

事务满足两阶段提交模型的要求
（1） 一阶段prepare行为
（2） 二阶段commit或rollback行为

AT模式与TCC模式的区别
（1）AT模式基于本地ACID事务的关系型数据库
一阶段prepare行为：本地事务中，一并提交业务数据更新和相应回滚日志记录
二阶段commit行为：马上成功结束，自动异步批量清理回滚日志
二阶段rollback行为：通过回滚日志，自动生成补偿操作，完成数据回滚
（2）TCC模式，不依赖于底层数据资源的数据支持
一阶段prepare行为：调用自定义的prepare逻辑
二阶段commit行为：调用自定义的commit逻辑
二阶段rollback行为：调用自定义的rollback逻辑
